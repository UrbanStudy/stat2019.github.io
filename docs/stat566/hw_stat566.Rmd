---
title: ""
author: ''
date: ""
output: html_document
---

#  {.tabset .tabset-fade .tabset-pills}

```{r setup, include=F}
knitr::opts_chunk$set(message=FALSE, warning=F, echo=F)
options(width = 2000)
options(repos="https://cran.rstudio.com")
```

## HW1

### Problem 1: 
In a home economic experiment, two temperatures (factor A) and two lengths of washing time (factor B) gave the following treatment means. The experiment was conducted as a completely randomized design with n=5 for teach treatment combination. The variable of interest was the amount of impurities (in grams) remaining in the material washed. Assume fixed effects for both factors.

```{r echo=FALSE}
library(kableExtra)
Factor <- c("(1)","a","b","ab")
Mean <- c(6.2,14.1,5.4,7.8)
kable(t(data.frame(Factor,Mean)))%>%kable_styling("condensed",full_width = F, position = "center")
```

<!--|     |(1) |a	  |b	 |ab
| --- | -- | -- | -- | --
|Mean	|6.2 |14.1|5.4 |7.8-->

(i) Compute the numerical values of the following effects and interpret in terms of question context:

a. main effect of A

$A=\frac12(-\bar y_{(1)}+\bar y_a-\bar y_b+\bar y_{ab})=\frac12(-6.2+14.1-5.4+7.8)=5.15$

The average amount of impurities remaining in the material washed increase by 5.15 grams as the temperatures changes from low to high. 

b. main effect of B

$B=\frac12(-\bar y_{(1)}-\bar y_a+\bar y_b+\bar y_{ab})=\frac12(-6.2-14.1+5.4+7.8)=-3.55$

The average amount of impurities remaining in the material washed decrease by 3.55 grams as the lengths of washing time changes from short to long. 

c. interaction effect of A and B
	
$AB=\frac12(\bar y_{(1)}-\bar y_a-\bar y_b+\bar y_{ab})=\frac12(6.2-14.1-5.4+7.8)=-2.75$

The change in average amount of impurities remaining in the material washed when the temperatures changes from low to high at long wsahing time is smaller by 2.75 grams than short washing time. 

(ii) Explain which effect is highest from the effects in part (i).

The main effect of A is highest and main effect of B is smaller than that while it is higher than interaction effect.

(iii) Compute the sum of square for each effect in part (i).

$SS_A=\frac{n}4C_A^2=\frac{n}4(-\bar y_{(1)}+\bar y_a-\bar y_b+\bar y_{ab})^2=\frac54(-6.2+14.1-5.4+7.8)^2=132.6125$

$SS_B=\frac{n}4C_B^2=\frac{n}4(-\bar y_{(1)}-\bar y_a+\bar y_b+\bar y_{ab})^2=\frac54(-6.2-14.1+5.4+7.8)^2=63.0125$

$SS_{AB}=\frac{n}4C_{AB}^2=\frac{n}4(\bar y_{(1)}-\bar y_a-\bar y_b+\bar y_{ab})^2=\frac54(6.2-14.1-5.4+7.8)^2=37.8125$

```{r eval=FALSE, include=FALSE}
(14.1+7.8-6.2-5.4)^2*5/4
(5.4+7.8-6.2-14.1)^2*5/4
(7.8+6.2-14.1-5.4)^2*5/4
29.8*16+132.6125+63.0125+37.8125

132.6125/29.8
63.0125/29.8
37.8125/29.8

df(132.6125/29.8, 1, 16,log= FALSE)
df(63.0125/29.8, 1, 16,log= FALSE)
df(37.8125/29.8, 1, 16,log= FALSE)

pf(132.6125/29.8, 1, 16, lower.tail =F, log.p = FALSE)
pf(63.0125/29.8, 1, 16, lower.tail =F, log.p = FALSE)
pf(37.8125/29.8, 1, 16, lower.tail =F, log.p = FALSE)

1-pf(132.6125/29.8, 1, 16, lower.tail = TRUE, log.p = FALSE)
1-pf(63.0125/29.8, 1, 16, lower.tail = TRUE, log.p = FALSE)
1-pf(37.8125/29.8, 1, 16, lower.tail = TRUE, log.p = FALSE)
```

(iv) If the MSE = 29.8, then compute all the terms of the ANOVA table for this study.

|Source of Variation|   SS          |      df      | MS     | F      |P-value   |
|         ---       |   ---         |   ---        | ---    | ---    | ---      |
|Factor A           |132.6125       |   $2-1=1$    |132.6125|$\frac{132.6125}{29.8}=4.450084$|0.0510038 |
|Factor B           | 63.0125       |   $2-1=1$    | 63.0125|$\frac{63.0125}{29.8}=2.114513$|0.1652436 |
|Interaction AB     | 37.8125       |$(2-1)(2-1)=1$| 37.8125|$\frac{37.8125}{29.8}=1.268876$|0.2765897 |
|Error              |$29.8*16=476.8$|$4*(5-1)=16$  | 29.8   |
|     |$132.6125+63.0125+37.8125$|
|Total|$+476.8=710.2375$|$2^2*5-1=19$  |

(v) Based on your ANOVA table, explain which of effects in part (i) are statistically significant at 5% significance level.

Based on the ANOVA table, all the P-value are larger than 0.05. There is no factor has significant effects at 5% significance level.

### Problem 2: 

(i) Create a table of plus and minus for a $2^5$ factorial design. Make sure to use standard order of letter assignments for treatment combinations.

<iframe src="https://docs.google.com/spreadsheets/d/e/2PACX-1vQA5d57ghgj2L4D_2ZpRG1InfBd-3naBrFaJzFwXe78CL5jQ5sH-BTJ8A3DXLwuGV744-4588cxGBKJ/pubhtml?gid=0&amp;single=true&amp;widget=true&amp;headers=false" height="780" width="105%" frameborder="0" scrolling="no"></iframe>

<!--|     | A	| B	| C | D | E | AB | AC | AD | AE | BC | BD | BE | CD | CE | DE | ABC | ABD | ABE | ACD | ACE | ADE | BCD | BCE | BDE | CDE | ABCD | ABCE | ABDE | ACDE | BCDE | ABCDE |
| --- | --| --| --| --| --| -- | -- | -- | -- | -- | -- | -- | -- | -- | -- | --  | --  | --  | --  | --  | --  | --  | --  | --  | --  |  --  |  --  |  --  |  --  |  --  |  --   |
|(1)  | - | - | - | - | - | +  | +  | +  | +  | +  | +  | +  | +  | +  | +  | -   | -   | -   | -   | -   | -   | -   | -   | -   | -   |  +   |  +   |  +   |  +   |  +   |  -    |
|a    | + | - | - | - | - | -  | -  | -  | -  | +  | +  | +  | +  | +  | +  | +   | +   | +   | +   | +   | +   | -   | -   | -   | -   |  -   |  -   |  -   |  -   |  +   |  +    |
|b    | - | + | - | - | - | -  | +  | +  | +  | -  | -  | -  | +  | +  | +  | +   | +   | +   | -   | -   | -   | +   | +   | +   | -   |  -   |  -   |  -   |  +   |  -   |  +    |
|ab   | + | + | - | - | - | +  | -  | -  | -  | -  | -  | -  | +  | +  | +  | -   | -   | -   | +   | +   | +   | +   | +   | +   | -   |  +   |  +   |  +   |  -   |  -   |  -    |
|c    | - | - | + | - | - | +  | -  | +  | +  | -  | +  | +  | -  | -  | +  | +   | -   | -   | +   | +   | -   | +   | +   | -   | +   |  -   |  -   |  +   |  -   |  -   |  +    |
|ac   | + | - | + | - | - | -  | +  | -  | -  | -  | +  | +  | -  | -  | +  | -   | +   | +   | -   | -   | +   | +   | +   | -   | +   |  +   |  +   |  -   |  +   |  -   |  -    |
|bc   | - | + | + | - | - | -  | -  | +  | +  | +  | -  | -  | -  | -  | +  | -   | +   | +   | +   | +   | -   | -   | -   | +   | +   |  +   |  +   |  -   |  -   |  +   |  -    |
|abc  | + | + | + | - | - | +  | +  | -  | -  | +  | -  | -  | -  | -  | +  | +   | -   | -   | -   | -   | +   | -   | -   | +   | +   |  -   |  -   |  +   |  +   |  +   |  +    |
|d    | - | - | - | + | - | +  | +  | -  | +  | +  | -  | +  | -  | +  | -  | -   | +   | -   | +   | -   | +   | +   | -   | +   | +   |  -   |  +   |  -   |  -   |  -   |  +    |
|ad   | + | - | - | + | - | -  | -  | +  | -  | +  | -  | +  | -  | +  | -  | +   | -   | +   | -   | +   | -   | +   | -   | +   | +   |  +   |  -   |  +   |  +   |  -   |  -    |
|bd   | - | + | - | + | - | -  | +  | -  | +  | -  | +  | -  | -  | +  | -  | +   | -   | +   | +   | -   | +   | -   | +   | -   | +   |  +   |  -   |  +   |  -   |  +   |  -    |
|cd   | - | - | + | + | - | +  | -  | -  | +  | -  | -  | +  | +  | -  | -  | +   | +   | -   | -   | +   | +   | -   | +   | +   | -   |  +   |  -   |  -   |  +   |  +   |  -    |
|abd  | + | + | - | + | - | +  | -  | +  | -  | -  | +  | -  | -  | +  | -  | -   | +   | -   | -   | +   | -   | -   | +   | -   | +   |  -   |  +   |  -   |  +   |  +   |  +    |
|acd  | + | - | + | + | - | -  | +  | +  | -  | -  | -  | +  | +  | -  | -  | -   | -   | +   | +   | -   | -   | -   | +   | +   | -   |  -   |  +   |  +   |  -   |  +   |  +    |
|bcd  | - | + | + | + | - | -  | -  | -  | +  | +  | +  | -  | +  | -  | -  | -   | -   | +   | -   | +   | +   | +   | -   | -   | -   |  -   |  +   |  +   |  +   |  -   |  +    |
|abcd | + | + | + | + | - | +  | +  | +  | -  | +  | +  | -  | +  | -  | -  | +   | +   | -   | +   | -   | -   | +   | -   | -   | -   |  +   |  -   |  -   |  -   |  -   |  -    |
|e    | - | - | - | - | + | +  | +  | +  | -  | +  | +  | -  | +  | -  | -  | -   | -   | +   | -   | +   | +   | -   | +   | +   | +   |  +   |  -   |  -   |  -   |  -   |  +    |
|ae   | + | - | - | - | + | -  | -  | -  | +  | +  | +  | -  | +  | -  | -  | +   | +   | -   | +   | -   | -   | -   | +   | +   | +   |  -   |  +   |  +   |  +   |  -   |  -    |
|be   | - | + | - | - | + | -  | +  | +  | -  | -  | -  | +  | +  | -  | -  | +   | +   | -   | -   | +   | +   | +   | -   | -   | +   |  -   |  +   |  +   |  -   |  +   |  -    |
|ce   | - | - | + | - | + | +  | -  | +  | -  | -  | +  | -  | -  | +  | -  | +   | -   | +   | +   | -   | +   | +   | -   | +   | -   |  -   |  +   |  -   |  +   |  +   |  -    |
|de   | - | - | - | + | + | +  | +  | -  | -  | +  | -  | -  | -  | -  | +  | -   | +   | +   | +   | +   | -   | +   | +   | -   | -   |  -   |  -   |  +   |  +   |  +   |  -    |
|abe  | + | + | - | - | + | +  | -  | -  | +  | -  | -  | +  | +  | -  | -  | -   | -   | +   | +   | -   | -   | +   | -   | -   | +   |  +   |  -   |  -   |  +   |  +   |  +    |
|ace  | + | - | + | - | + | -  | +  | -  | +  | -  | +  | -  | -  | +  | -  | -   | +   | -   | -   | +   | -   | +   | -   | +   | -   |  +   |  -   |  +   |  -   |  +   |  +    |
|ade  | + | - | - | + | + | -  | -  | +  | +  | +  | -  | -  | -  | -  | +  | +   | -   | -   | -   | -   | +   | +   | +   | -   | -   |  +   |  +   |  -   |  -   |  +   |  +    |
|bce  | - | + | + | - | + | -  | -  | +  | -  | +  | -  | +  | -  | +  | -  | -   | +   | -   | +   | -   | +   | -   | +   | -   | -   |  +   |  -   |  +   |  +   |  -   |  +    |
|bde  | - | + | - | + | + | -  | +  | -  | -  | -  | +  | +  | -  | -  | +  | +   | -   | -   | +   | +   | -   | -   | -   | +   | -   |  +   |  +   |  -   |  +   |  -   |  +    |
|cde  | - | - | + | + | + | +  | -  | -  | -  | -  | -  | -  | +  | +  | +  | +   | +   | +   | -   | -   | -   | -   | -   | -   | +   |  +   |  +   |  +   |  -   |  -   |  +    |
|abce | + | + | + | - | + | +  | +  | -  | +  | +  | -  | +  | -  | +  | -  | +   | -   | +   | -   | +   | -   | -   | +   | -   | -   |  -   |  +   |  -   |  -   |  -   |  -    |
|abde | + | + | - | + | + | +  | -  | +  | +  | -  | +  | +  | -  | -  | +  | -   | +   | +   | -   | -   | +   | -   | -   | +   | -   |  -   |  -   |  +   |  -   |  -   |  -    |
|acde | + | - | + | + | + | -  | +  | +  | +  | -  | -  | -  | +  | +  | +  | -   | -   | -   | +   | +   | +   | -   | -   | -   | +   |  -   |  -   |  -   |  +   |  -   |  -    |
|bcde | - | + | + | + | + | -  | -  | -  | -  | +  | +  | +  | +  | +  | +  | -   | -   | -   | -   | -   | -   | +   | +   | +   | +   |  -   |  -   |  -   |  -   |  +   |  -    |
|abcde| + | + | + | + | + | +  | +  | +  | +  | +  | +  | +  | +  | +  | +  | +   | +   | +   | +   | +   | +   | +   | +   | +   | +   |  +   |  +   |  +   |  +   |  +   |  +    | 
-->

```{r echo=FALSE, message=FALSE,}
library(dplyr)
five_factor <- tribble(
~effect, ~A, ~B, ~C, ~D, ~E, ~AB, ~AC, ~AD, ~AE, ~BC, ~BD, ~BE, ~CD, ~CE, ~DE, ~ABC, ~ABD, ~ABE, ~ACD, ~ACE, ~ADE, ~BCD, ~BCE, ~BDE, ~CDE, ~ABCD, ~ABCE, ~ABDE, ~ACDE, ~BCDE, ~ABCDE,
"1" , "[-]", "[-]", "[-]", "[-]", "[-]", "[+]", "[+]", "[+]", "[+]", "[+]", "[+]", "[+]", "[+]", "[+]", "[+]", "[-]", "[-]", "[-]", "[-]", "[-]", "[-]", "[-]", "[-]", "[-]", "[-]","[+]","[+]","[+]","[+]","[+]","[-]" ,
"a"   , "[+]", "[-]", "[-]", "[-]", "[-]", "[-]", "[-]", "[-]", "[-]", "[+]", "[+]", "[+]", "[+]", "[+]", "[+]", "[+]", "[+]", "[+]", "[+]", "[+]", "[+]", "[-]", "[-]", "[-]", "[-]","[-]","[-]","[-]","[-]","[+]","[+]" ,
"b"   , "[-]", "[+]", "[-]", "[-]", "[-]", "[-]", "[+]", "[+]", "[+]", "[-]", "[-]", "[-]", "[+]", "[+]", "[+]", "[+]", "[+]", "[+]", "[-]", "[-]", "[-]", "[+]", "[+]", "[+]", "[-]","[-]","[-]","[-]","[+]","[-]","[+]" ,
"ab"  , "[+]", "[+]", "[-]", "[-]", "[-]", "[+]", "[-]", "[-]", "[-]", "[-]", "[-]", "[-]", "[+]", "[+]", "[+]", "[-]", "[-]", "[-]", "[+]", "[+]", "[+]", "[+]", "[+]", "[+]", "[-]","[+]","[+]","[+]","[-]","[-]","[-]" ,
"c"   , "[-]", "[-]", "[+]", "[-]", "[-]", "[+]", "[-]", "[+]", "[+]", "[-]", "[+]", "[+]", "[-]", "[-]", "[+]", "[+]", "[-]", "[-]", "[+]", "[+]", "[-]", "[+]", "[+]", "[-]", "[+]","[-]","[-]","[+]","[-]","[-]","[+]" ,
"ac"  , "[+]", "[-]", "[+]", "[-]", "[-]", "[-]", "[+]", "[-]", "[-]", "[-]", "[+]", "[+]", "[-]", "[-]", "[+]", "[-]", "[+]", "[+]", "[-]", "[-]", "[+]", "[+]", "[+]", "[-]", "[+]","[+]","[+]","[-]","[+]","[-]","[-]" ,
"bc", "[-]", "[+]", "[+]", "[-]", "[-]", "[-]", "[-]", "[+]", "[+]", "[+]", "[-]", "[-]", "[-]", "[-]", "[+]", "[-]", "[+]", "[+]", "[+]", "[+]", "[-]", "[-]", "[-]", "[+]", "[+]","[+]","[+]","[-]","[-]","[+]","[-]" ,
"abc", "[+]", "[+]", "[+]", "[-]", "[-]", "[+]", "[+]", "[-]", "[-]", "[+]", "[-]", "[-]", "[-]", "[-]", "[+]", "[+]", "[-]", "[-]", "[-]", "[-]", "[+]", "[-]", "[-]", "[+]", "[+]","[-]","[-]","[+]","[+]","[+]","[+]" ,
"d" , "[-]", "[-]", "[-]", "[+]", "[-]", "[+]", "[+]", "[-]", "[+]", "[+]", "[-]", "[+]", "[-]", "[+]", "[-]", "[-]", "[+]", "[-]", "[+]", "[-]", "[+]", "[+]", "[-]", "[+]", "[+]","[-]","[+]","[-]","[-]","[-]","[+]" ,
"ad", "[+]", "[-]", "[-]", "[+]", "[-]", "[-]", "[-]", "[+]", "[-]", "[+]", "[-]", "[+]", "[-]", "[+]", "[-]", "[+]", "[-]", "[+]", "[-]", "[+]", "[-]", "[+]", "[-]", "[+]", "[+]","[+]","[-]","[+]","[+]","[-]","[-]" ,
"bd", "[-]", "[+]", "[-]", "[+]", "[-]", "[-]", "[+]", "[-]", "[+]", "[-]", "[+]", "[-]", "[-]", "[+]", "[-]", "[+]", "[-]", "[+]", "[+]", "[-]", "[+]", "[-]", "[+]", "[-]", "[+]","[+]","[-]","[+]","[-]","[+]","[-]" ,
"cd", "[-]", "[-]", "[+]", "[+]", "[-]", "[+]", "[-]", "[-]", "[+]", "[-]", "[-]", "[+]", "[+]", "[-]", "[-]", "[+]", "[+]", "[-]", "[-]", "[+]", "[+]", "[-]", "[+]", "[+]", "[-]","[+]","[-]","[-]","[+]","[+]","[-]" ,
"abd", "[+]", "[+]", "[-]", "[+]", "[-]", "[+]", "[-]", "[+]", "[-]", "[-]", "[+]", "[-]", "[-]", "[+]", "[-]", "[-]", "[+]", "[-]", "[-]", "[+]", "[-]", "[-]", "[+]", "[-]", "[+]","[-]","[+]","[-]","[+]","[+]","[+]" ,
"acd", "[+]", "[-]", "[+]", "[+]", "[-]", "[-]", "[+]", "[+]", "[-]", "[-]", "[-]", "[+]", "[+]", "[-]", "[-]", "[-]", "[-]", "[+]", "[+]", "[-]", "[-]", "[-]", "[+]", "[+]", "[-]","[-]","[+]","[+]","[-]","[+]","[+]" ,
"bcd", "[-]", "[+]", "[+]", "[+]", "[-]", "[-]", "[-]", "[-]", "[+]", "[+]", "[+]", "[-]", "[+]", "[-]", "[-]", "[-]", "[-]", "[+]", "[-]", "[+]", "[+]", "[+]", "[-]", "[-]", "[-]","[-]","[+]","[+]","[+]","[-]","[+]" ,
"abcd" , "[+]", "[+]", "[+]", "[+]", "[-]", "[+]", "[+]", "[+]", "[-]", "[+]", "[+]", "[-]", "[+]", "[-]", "[-]", "[+]", "[+]", "[-]", "[+]", "[-]", "[-]", "[+]", "[-]", "[-]", "[-]","[+]","[-]","[-]","[-]","[-]","[-]" ,
"e" , "[-]", "[-]", "[-]", "[-]", "[+]", "[+]", "[+]", "[+]", "[-]", "[+]", "[+]", "[-]", "[+]", "[-]", "[-]", "[-]", "[-]", "[+]", "[-]", "[+]", "[+]", "[-]", "[+]", "[+]", "[+]","[+]","[-]","[-]","[-]","[-]","[+]" ,
"ae", "[+]", "[-]", "[-]", "[-]", "[+]", "[-]", "[-]", "[-]", "[+]", "[+]", "[+]", "[-]", "[+]", "[-]", "[-]", "[+]", "[+]", "[-]", "[+]", "[-]", "[-]", "[-]", "[+]", "[+]", "[+]","[-]","[+]","[+]","[+]","[-]","[-]" ,
"be", "[-]", "[+]", "[-]", "[-]", "[+]", "[-]", "[+]", "[+]", "[-]", "[-]", "[-]", "[+]", "[+]", "[-]", "[-]", "[+]", "[+]", "[-]", "[-]", "[+]", "[+]", "[+]", "[-]", "[-]", "[+]","[-]","[+]","[+]","[-]","[+]","[-]" ,
"ce", "[-]", "[-]", "[+]", "[-]", "[+]", "[+]", "[-]", "[+]", "[-]", "[-]", "[+]", "[-]", "[-]", "[+]", "[-]", "[+]", "[-]", "[+]", "[+]", "[-]", "[+]", "[+]", "[-]", "[+]", "[-]","[-]","[+]","[-]","[+]","[+]","[-]" ,
"de", "[-]", "[-]", "[-]", "[+]", "[+]", "[+]", "[+]", "[-]", "[-]", "[+]", "[-]", "[-]", "[-]", "[-]", "[+]", "[-]", "[+]", "[+]", "[+]", "[+]", "[-]", "[+]", "[+]", "[-]", "[-]","[-]","[-]","[+]","[+]","[+]","[-]" ,
"abe", "[+]", "[+]", "[-]", "[-]", "[+]", "[+]", "[-]", "[-]", "[+]", "[-]", "[-]", "[+]", "[+]", "[-]", "[-]", "[-]", "[-]", "[+]", "[+]", "[-]", "[-]", "[+]", "[-]", "[-]", "[+]","[+]","[-]","[-]","[+]","[+]","[+]" ,
"ace", "[+]", "[-]", "[+]", "[-]", "[+]", "[-]", "[+]", "[-]", "[+]", "[-]", "[+]", "[-]", "[-]", "[+]", "[-]", "[-]", "[+]", "[-]", "[-]", "[+]", "[-]", "[+]", "[-]", "[+]", "[-]","[+]","[-]","[+]","[-]","[+]","[+]" ,
"ade", "[+]", "[-]", "[-]", "[+]", "[+]", "[-]", "[-]", "[+]", "[+]", "[+]", "[-]", "[-]", "[-]", "[-]", "[+]", "[+]", "[-]", "[-]", "[-]", "[-]", "[+]", "[+]", "[+]", "[-]", "[-]","[+]","[+]","[-]","[-]","[+]","[+]" ,
"bce", "[-]", "[+]", "[+]", "[-]", "[+]", "[-]", "[-]", "[+]", "[-]", "[+]", "[-]", "[+]", "[-]", "[+]", "[-]", "[-]", "[+]", "[-]", "[+]", "[-]", "[+]", "[-]", "[+]", "[-]", "[-]","[+]","[-]","[+]","[+]","[-]","[+]" ,
"bde", "[-]", "[+]", "[-]", "[+]", "[+]", "[-]", "[+]", "[-]", "[-]", "[-]", "[+]", "[+]", "[-]", "[-]", "[+]", "[+]", "[-]", "[-]", "[+]", "[+]", "[-]", "[-]", "[-]", "[+]", "[-]","[+]","[+]","[-]","[+]","[-]","[+]" ,
"cde", "[-]", "[-]", "[+]", "[+]", "[+]", "[+]", "[-]", "[-]", "[-]", "[-]", "[-]", "[-]", "[+]", "[+]", "[+]", "[+]", "[+]", "[+]", "[-]", "[-]", "[-]", "[-]", "[-]", "[-]", "[+]","[+]","[+]","[+]","[-]","[-]","[+]" ,
"abce" , "[+]", "[+]", "[+]", "[-]", "[+]", "[+]", "[+]", "[-]", "[+]", "[+]", "[-]", "[+]", "[-]", "[+]", "[-]", "[+]", "[-]", "[+]", "[-]", "[+]", "[-]", "[-]", "[+]", "[-]", "[-]","[-]","[+]","[-]","[-]","[-]","[-]" ,
"abde" , "[+]", "[+]", "[-]", "[+]", "[+]", "[+]", "[-]", "[+]", "[+]", "[-]", "[+]", "[+]", "[-]", "[-]", "[+]", "[-]", "[+]", "[+]", "[-]", "[-]", "[+]", "[-]", "[-]", "[+]", "[-]","[-]","[-]","[+]","[-]","[-]","[-]" ,
"acde" , "[+]", "[-]", "[+]", "[+]", "[+]", "[-]", "[+]", "[+]", "[+]", "[-]", "[-]", "[-]", "[+]", "[+]", "[+]", "[-]", "[-]", "[-]", "[+]", "[+]", "[+]", "[-]", "[-]", "[-]", "[+]","[-]","[-]","[-]","[+]","[-]","[-]" ,
"bcde" , "[-]", "[+]", "[+]", "[+]", "[+]", "[-]", "[-]", "[-]", "[-]", "[+]", "[+]", "[+]", "[+]", "[+]", "[+]", "[-]", "[-]", "[-]", "[-]", "[-]", "[-]", "[+]", "[+]", "[+]", "[+]","[-]","[-]","[-]","[-]","[+]","[-]" ,
"abcde", "[+]", "[+]", "[+]", "[+]", "[+]", "[+]", "[+]", "[+]", "[+]", "[+]", "[+]", "[+]", "[+]", "[+]", "[+]", "[+]", "[+]", "[+]", "[+]", "[+]", "[+]", "[+]", "[+]", "[+]", "[+]","[+]","[+]","[+]","[+]","[+]","[+]"
)

five_factor%>%mutate(ABCD=cell_spec(ABCD,background=ifelse(ABCD=="[-]","#EAFAF1","#f9ece9")))%>%kable(,"html",escape = F) %>%kable_styling("condensed",font_size = 9, full_width = F)

```

(ii) Write a contrast statement for the four factor interaction effect using standard order of letters as we did in class. Assume n replications for each treatment combination.

$$ABCD=\bar y_{(1)}-\bar y_a-\bar y_b+\bar y_{ab}-\bar y_c+\bar y_{ac}+\bar y_{bc}-\bar y_{abc}-\bar y_d+\bar y_{ad}+\bar y_{bd}+\bar y_{cd}-\bar y_{abd}-\bar y_{acd}-\bar y_{bcd}+\bar y_{abcd}$$
$$+\bar y_e-\bar y_{ae}-\bar y_{be}-\bar y_{ce}-\bar y_{de}+\bar y_{abe}+\bar y_{ace}+\bar y_{ade}+\bar y_{bce}+\bar y_{bde}+\bar y_{cde}-\bar y_{abce}-\bar y_{abde}-\bar y_{acde}-\bar y_{bcde}+\bar y_{abcde}$$

### Problem 3:

(a). contruct a normal probability plot of these effects. Then explain and name the effects that are neglegible.

```{r echo=FALSE,message=FALSE, results='hold', out.width='30%'}
# hw1_3 <- tribble(~factors, ~effect, "A",76.95, "B", -67.52,"C",-7.84, "D",-18.73, "AB", -51.32, "AC", 11.69, "AD",9.78, "BC", 20.78, "BD", 14.74, "CD", 1.27, "ABC", -2.82, "ABD", -6.5, "ACD",10.2, "BCD",-7.98, "ABCD",-6.25)

factors <-c("A","B","C","D","AB","AC","AD","BC","BD","CD","ABC","ABD", "ACD","BCD","ABCD")
effect <- c(76.95,-67.52,-7.84,-18.73,-51.32,11.69,9.78,20.78,14.74,1.27,-2.82,-6.5,10.2,-7.98,-6.25)
hw1_3 <- data.frame(factors,effect)

library(ggplot2)
# hw1_3_qq<-ggplot(hw1_3, aes(sample = effect),label=factors) + stat_qq()
# hw1_3_new<-ggplot_build(hw1_3_qq)$data[[1]]
#### hw1_3_new$name<-hw1_3_new$name[order(hw1_3$effect)]
# hw1_3_new%>%mutate(name=hw1_3$factors[order(hw1_3$effect)])%>%
# ggplot(aes(theoretical,sample,label=name))+geom_text()+stat_qq_line(aes(sample = y), line.p = c(0.25, 0.75),linetype=4, col = "red")+ theme_light()
library(gghalfnorm)
gghalfnorm(x = hw1_3$effect,labs = as.character(hw1_3$factors), nlab = 3)+ theme_light()
# library(daewr) 
# halfnorm(hw1_3$effect, names(as.character(hw1_3$factors)), alpha = 0.05)
```

Based on the normal QQ plot, only the effects of $A, B, AB$ are non-negligible. The reset factors gather around the quantile-quantile line. The effects or interaction effects of rest factors are negligible.

(b).Identify a tentative model, based on the plot of the effects in part (a) write the theoretical model fit for these data without neglegible terms.

The single replicate $2^4$ factorial model with fixed effects and replications, and without neglegible terms is:

$$y_{ijk}=\mu+\tau_i+\beta_j+(\tau\beta)_{ij}+\varepsilon_{ijk}$$
for $i=1,2$ ; $j=1,2$; $k=1,2,3,4$, where 

$\tau_i$ is fixed main effect of $i^{th}$ level of  Factor A;

$\beta_j$ is fixed main effect of $j^{th}$ level of Factor B;

$(\tau\beta)_{ij}$ is fixed interaction effect of $i^{th}$ level of Factor A and $j^{th}$ level of Factor B;

$\varepsilon_{ijk}$ is random error for the single replicate Exerimental Unit when $i^{th}$ level of Factor A and $j^{th}$ level of Factor B are applied.

$y_{ijk}$ is response for the 4 replicate EU when  $i^{th}$ level of Factor A and  $j^{th}$ level of Factor B are applied.

Assumptions:

$\varepsilon_{ijk}\sim iid N(0,\sigma^2)$; $\sum_i^2\tau_i=0$; $\sum_j^2\beta_j=0$; $\sum_i^2(\tau\beta)_{ij}=0$; $\sum_j^2(\tau\beta)_{ij}=0$

## HW2

### Problem 1: 
Note: This is a $2^3$ design with replications for each treatment combination. Analyze the data as a typical 3-factor factorial design.
In part (a), do all the necessary tests and report conclusions along with p values appropriately.

```{r echo=F, message=F,collapse=T, results='hold', out.width='30%'}
hw2_1_table <- readxl::read_excel("Table6_6.xlsx")
hw2_1_table <- hw2_1_table%>%mutate(hw2_1_rep=c(rep(c(1,2),8)))
hw2_1_model <- aov(y~A*B*C,hw2_1_table)
hw2_1_effect<- coef(hw2_1_model)[2:8]
daewr::halfnorm(hw2_1_effect,alpha=0.55)

hw2_1_table$A <- as.factor(hw2_1_table$A)
hw2_1_table$B <- as.factor(hw2_1_table$B)
hw2_1_table$C <- as.factor(hw2_1_table$C)
library(kableExtra)
kable(t(hw2_1_table)) %>%kable_styling("striped", full_width = F)
library(ggpubr)
ggline(data = hw2_1_table, x = "A", y = "y", add = c("mean", "jitter"),shape= "B",  color = "C", linetype = "C", ylab= "y", xlab="A")

pander::pander(summary(hw2_1_model))

# hw2_1_model_non_neg <- aov(y~A*C,hw2_1_table)
# pander::pander(summary(hw2_1_model_non_neg))
```
Based on ANOVA table, factor C, AB, AC, BC have significant effects at 0.05 significance level. Their P-values are 0.008516,0.005602, 0.0004176, 0.003728 respectivly. That means, effect of class of mail, type of mail, and offered price on average number of orders are not independent. Therefore, simple effects examinations are recommended.

```{r echo=F, message=F,collapse=T, results='hold', out.width='30%'}
library(mosaic)
kable(favstats(y ~ A, data=hw2_1_table)) %>%kable_styling("striped", full_width = F,font_size = 6)
kable(favstats(y ~ B, data=hw2_1_table)) %>%kable_styling("striped", full_width = F,font_size = 6)
kable(favstats(y ~ A+B, data=hw2_1_table)) %>%kable_styling("striped", full_width = F,font_size = 6)
kable(favstats(y ~ A+C, data=hw2_1_table)) %>%kable_styling("striped", full_width = F,font_size = 6)
kable(favstats(y ~ B+C, data=hw2_1_table)) %>%kable_styling("striped", full_width = F,font_size = 6)
kable(favstats(y ~ A+B+C, data=hw2_1_table)) %>%kable_styling("striped", full_width = F,font_size = 6)
hw2_1_model <- aov(y~A*B*C,hw2_1_table)
library(emmeans)
a_b <- pairs(lsmeans(hw2_1_model,~ A|B))
a_c <- pairs(lsmeans(hw2_1_model,~ A|C))
b_c <- pairs(lsmeans(hw2_1_model,~ B|C))
test(rbind(a_b,a_c,b_c),adjust="tukey")[1:6,]
kable(test(rbind(a_b,a_c,b_c),adjust="tukey")[1:6,],format="latex")%>%kable_styling("condensed",full_width=F,font_size = 6)
```


 ---

In part (b), provide plots along with your answer.

```{r echo=F, message=F, results='hold', out.width='30%'}
hw2_1_table$y_resid<- rstudent(hw2_1_model)
hist(hw2_1_table$y_resid,, breaks =12)
plot(hw2_1_model)
```

The histogram of residuals and the QQ plot didn't show obvious violation of normality.

The plot of residuals versus fitted value shows the residuals are evenly distributed about zero at each prededict value (zero mean). A few outliers are acceptable.

The plot of studentized residuals versus fitted value shows vertical deviations of residuals from zero are almost the same for each predicted value (constant variance) with respect to the small sample size.

 ---

In Part(c), clearly recommend which factor levels appropriately in question context and provide reasons.

Base on the half-normal quantiles plot, only the effect of factor ABC is negligible after estimating all effects. 

```{r echo=F, message=F, results='hold', out.width='30%'}

hw2_1_effect<- coef(hw2_1_model)[2:8]
daewr::halfnorm(hw2_1_effect,alpha=0.55)

# hw2_1_table_mean <- hw2_1_table%>%group_by(A,B,C)%>%summarise(mean_y=mean(y))
# hw2_1_model_mean <- aov(mean_y~A*B*C,hw2_1_table_mean)
# pander::pander(summary(hw2_1_model_mean))

# hw2_1_model_ln <- lm(log(y)~A+C,hw2_1_table)
# pander::pander(summary(hw2_1_model_ln))
# plot(hw2_1_model_ln)
```


### Problem 2:

Scientists wish to understand how the amount of sugar (A with two levels), culture strain (B with two levels), type of fruit (C with blueberry or strawberry), and pH (D with two levels) influence shelf life of refrigerated yogurt. In a preliminary experiment, they produce one batch of each of the sixteen kinds of yogurt. The yogurt is then placed in two coolers, eight batches in each cooler. The response is the number of days till an off odor is detected from the batch.
Analyze these data to determine how the treatments affect time till off odor.

ABCD effects are confounded with blocks according to given table of data.

```{r echo=F, message=F, results='hold', out.width='30%'}
hw2_2_y <- c(34,34,32,34,34,39,38,37, 35,36,39,41,39,44,44,42)
hw2_2_block <- c(rep(1,8),rep(2,8))
hw2_2_name <- c("(1)","ab", "ac", "ad", "bc", "bd", "cd", "abcd", "a", "b", "c", "d", "abc", "abd", "acd", "bcd")
hw2_2_table <- data.frame(hw2_2_name,hw2_2_block,hw2_2_y)

hw2_2_table <- hw2_2_table[c(1,9,10,2,11,3,5,13,12,4,6,14,7,15,16,8),]
hw2_2_table <- cbind(hw2_2_table,FrF2::FrF2(16,4,randomize = F))

hw2_2_model <- aov(hw2_2_y~hw2_2_block+A*B*C*D,hw2_2_table)
hw2_2_effect <- coef(hw2_2_model)[3:16]

library(daewr)
halfnorm(hw2_2_effect,alpha=0.15)

# library(ggplot2)
# library(gghalfnorm)
# gghalfnorm(hw2_2_effect,labs =names(hw2_2_effect), nlab=4)+ theme_light()
```
Form the half-normal quantiles plot, D effects is non-negligible after estimating all effects. 

The complete model you would fit for these data based on the finding. 

The single replicate $2^4$ factorial model with confounde ABCD effect as blocks, and without neglegible terms is:

$$y_{ijk}=\mu+\tau_i+\beta_{j}+\varepsilon_{ijk}$$
for $i=1,2$ ; $j=1,2$; $k=1,2,3,4$, where 

$\tau_i$ is fixed main effect of $i^{th}$ level of  Factor D;

$\beta_{j}$ is effect of $j^{th}$ level of block;

$\varepsilon_{ijk}$ is random error for the $k^{th}$ replicate Exerimental Units when $i^{th}$ level of Factor D and $j^{th}$ level of block are applied.

$y_{ijk}$ is response for the $k^{th}$ replicate EU when  $i^{th}$ level of Factor D and  $j^{th}$ level of block are applied.

Assumptions:

$\varepsilon_{ij}\sim iid N(0,\sigma^2)$; $\sum_i^2\tau_i=0$

Fit the model with non-negligible effects and block effects. get the complete ANOVA table.

```{r eval=FALSE, message=FALSE, include=FALSE, out.width='30%', results='hold'}
hw2_2_model_non_neg <- aov(hw2_2_y~hw2_2_block+D,hw2_2_table)
pander::pander(summary(hw2_2_model_non_neg))
sum((hw2_2_table$hw2_2_y- mean(hw2_2_table$hw2_2_y))^2)

```

 ---------------------------------------------------------------
     &nbsp;        Df   Sum Sq   Mean Sq   F value    Pr(>F)   
 ----------------- ---- -------- --------- --------- -----------
  **hw2_2_block**   1    90.25     90.25     28.97    0.0001249 

      **D**         1      81       81        26      0.0002041 

   **Residuals**    13    40.5     3.115     

   **Total**        15  211.75 
 ---------------------------------------------------------------

 Based on the ANOVA table, factor D and block effects are significant at 5% significance level.


### Problem 3:

Consider the single replicated $2^3$ factorial design with ABC confounded with two blocks.
Prove algebraically the $SS_{ABC}=SS_{Block}$ (see the example did in class for $2^2$ design)

Factor ABC is confounded with two blocks, $p=2$

$$C_{ABC}=-y_{(1)}+ y_{a}+y_{b}- y_{ab}+ y_{c}- y_{ac}- y_{bc}+ y_{abc}$$

$$SS_{ABC}=\sum_i^2\sum_j^2\sum_k^2(\hat\tau\hat\beta\hat\gamma)_{ijk}^2=[\frac12(y_{211}-y_{111})-\frac12(y_{221}-y_{121})-\frac12(y_{212}-y_{112})+\frac12(y_{222}-y_{122})]^2$$

$$=\frac1{2^2}(-y_{111}+y_{211}+y_{121}-y_{221}+y_{112}-y_{212}-y_{122}+y_{222})^2=\frac{1}{2^2}C_{ABC}^2$$

$$SS_{Block}=\sum_i^2\sum_j^2\sum_k^2\sum_l^2\hat\delta_l^2=2^3(\delta_1^2+\delta_2^2)=2^3[(\bar y_{blk1}-\bar y_{...})^2+(\bar y_{blk2}-\bar y_{...})^2]$$

$\bar y_{blk1}-\bar y_{...}=\frac{1}{4}[y_{(1)}+y_{ab}+y_{ac}+y_{bc}]-\bar y_{...}=\frac{1}{4}[y_{111}+y_{221}+y_{212}+y_{122}]-\frac{1}{8}[y_{111}+y_{211}+y_{121}+y_{221}+y_{112}+y_{212}+y_{122}+y_{222}]$

$=\frac{1}{8}[y_{111}-y_{211}-y_{121}+y_{221}-y_{112}+y_{212}+y_{122}-y_{222}]=\frac18[y_{(1)}-y_{a}-y_{b}+y_{ab}-y_{c}+ y_{ac}+y_{bc}-y_{abc}]=-\frac18C_{ABC}$

By the same way, $\bar y_{blk2}-\bar y_{...}=\frac18C_{ABC}$

Therefore,

$$SS_{Block}=2^3[(-\frac18C_{ABC})^2+(\frac18C_{ABC})^2]=\frac1{2^2}C_{ABC}^2=SS_{ABC}$$


### Problem 4:

A $2^4$ factorial experiment is planned but complete blocks of 16 experimental units (EUs) cannot be obtained. Numerous blocks of 8 homogenous EU are available. Assume that we obtain only one observation for each treatment combination.

Using the methods learned in the class, give a random assignment of treatment combinations in the blocks for each of the following scenario. (You have to decide how many blocks to use based on given information here)

There are $2^4=16$ treatment combination, 16 observation. There are $16/8=2$ blocks of 8 homogenous EU.

(a)  the ABCD interaction is confounded with incomplete blocks

|Block1 | Block2|
|  ---  |  ---  |
|(1),ab, ac, bc, ad, bd, cd abcd | a, b, c, abc, d, abd, acd, bcd|

(b)  the ABC interaction is confounded with incomplete blocks

|Block1 | Block2|
| ---   | --- |
|(1), ab, ac, bc, d, abd, acd, bcd | a, b, c, abc, ad, bd, cd, abcd|


### Problem 5:

A researcher needs to conduct a 24 factorial experiment but cannot obtain complete blocks. Two blocks of 8 homogeneous experimental units (EU)s are obtained and the researcher arbitrarily assigns treatments to the blocks.
The following two treatment assignments are given. For each of the above assignments, report all the effects that are confounded with incomplete blocks.

|   | Block 1 | Block 2 | confounded effects |
| --- | --- | --- | --- |
|(i) |a, ab, ac, abc, bd, bcd, cd, d	  | (1), ad, abd, acd, abcd, b, c, bc| AD |
|(ii)|(1), a, abc, abd, acd, bc, bd, cd|ab, ac, ad, abcd, b, c, bcd, d| BCD |


### Problem 6:

A 24 factorial experiment is to be conducted in 4 blocks with ABC interaction and BCD interaction effects are confounded with incomplete blocks with single replication.
(a) What other effects, if any, are confounded with incomplete blocks? Explain.

$ABC\times BCD=AB^2C^2D=AD$ is confounded with incomplete blocks automatically.

$2^p-p-1=2^2-2-1=1$. There is only one automaticlly confounded effect.

(b) Give the treatment assignment of blocks for one replication of experiment.

| Block1 | Block2| Block3 | Block4|
| --- | --- | --- | --- |
| ABC- | ABC- | ABC+ | ABC+ |
| BCD- | BCD+ | BCD- | BCD+ |
| (1) | ab | a  | b  |
| bc  | ac | abc| c  |
| abd | bcd| bd | ad |
| acd |  d | cd |abcd|


(c) Provide the partial ANVOA table with source and degrees of freedom for this design.

|source|$SS_{Blk}$|$SS_A$|$SS_B$|$SS_{AB}$|$SS_{C}$|$SS_{AC}$|$SS_{BC}$|$SS_{D}$|$SS_{BD}$|$SS_{ABD}$|$SS_{CD}$|$SS_{ACD}$|$SS_{ABCD}$|$SS_E$|$SS_T$|
| ---  | ---      | ---  | ---  | ---     | ---    |    ---  |    ---  |   ---  |    ---  |     ---  |    ---  |     ---  |      ---  | ---  | --- |
|   df |  3       |   1  |   1  |   1     |   1    |   1     |   1     |   1    |   1     |       1  |      1  |       1  |        1  |   0  |15   |


### Problem 7:

Consider the 25 factorial design in 2 blocks. If ABCDE interaction effect is confounded with blocks, then list the remaining treatment combinations in the same block as acde.

(1), ab, ac, bc, ad, bd, cd, abcd, ae, be, ce, abce, de, abde, acde, bcde